<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Irrigation Program</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- PDF eksport (html2pdf) -->
  <!-- NOTE: Integrity olib tashlandi, chunki u yuklanishni bloklashi mumkin. -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <main class="wrap">
    <header class="top">
      <div>
        <h1>Irrigation Program</h1>
        <p class="sub">
          Sug‘orish bo‘yicha qaror chiqarish vositasi: API (Open-Meteo) natijalari va manual (FAO-56 Penman–Monteith)
          hisob-kitoblarini taqqoslash.
        </p>
      </div>

      <div class="topActions">
        <button id="locate" class="btn ghost">Joylashuvni aniqlash</button>
        <button id="downloadPdf" class="btn">PDF yuklab olish</button>
      </div>
    </header>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active" data-tab="api">API rejim</button>
      <button class="tab" data-tab="manual">Manual rejim</button>
      <button class="tab" data-tab="report">Hisobot</button>
      <span id="status" class="status"></span>
    </nav>

    <!-- API TAB -->
    <section id="tab-api" class="card tabPanel active">
      <h2>API rejim (Open-Meteo)</h2>

      <div class="grid">
        <label>
          Latitude
          <input id="api_lat" type="number" step="0.000001" value="0" />
        </label>

        <label>
          Longitude
          <input id="api_lon" type="number" step="0.000001" value="0" />
        </label>

        <label>
          Altitude (m)
          <input id="api_alt" type="number" step="1" value="0" />
        </label>

        <label>
          Sana (YYYY-MM-DD)
          <input id="api_date" type="date" />
        </label>

        <label>
          Vaqt (HH:MM) ixtiyoriy
          <input id="api_time" type="time" />
        </label>

        <label>
          Kc
          <input id="api_kc" type="number" step="0.01" value="0" />
        </label>

        <label>
          RAW chegarasi (%)
          <input id="api_raw" type="number" step="0.1" value="0" />
        </label>

        <label>
          Tuproq namligi (%) ixtiyoriy (manual)
          <input id="api_soilManual" type="number" step="0.1" placeholder="Bo‘sh qoldirsangiz API oladi" />
        </label>
      </div>

      <div class="row">
        <button id="runApi" class="btn">API hisoblash</button>
      </div>

      <details class="note">
        <summary>Eslatma</summary>
        <ul>
          <li><b>ET₀:</b> referens evapotranspiratsiya (FAO-56). API rejimda ET₀ Open-Meteo’dan olinadi.</li>
          <li><b>ETc:</b> ekin evapotranspiratsiyasi. ETc = Kc × ET₀.</li>
          <li><b>Kc:</b> ekin koeffitsiyenti (ekin turi va bosqichiga bog‘liq).</li>
          <li><b>RAW (%):</b> sug‘orish chegarasi. Tuproq namligi RAW dan past (yoki teng) bo‘lsa sug‘orish tavsiya etiladi.</li>
          <li><b>TAW:</b> ildiz zonasida o‘simlik foydalanishi mumkin bo‘lgan umumiy suv zaxirasi (bu dasturda foiz ko‘rinishida baholanadi).</li>
          <li><b>Vaqt:</b> kiritilsa, aynan o‘sha vaqtda sug‘orish kerak/kerak emas degan javob chiqadi. Kiritilmasa, bu javob ko‘rsatilmaydi.</li>
          <li><b>Dastur:</b> joy + sana bo‘yicha soatlik/kundalik ma’lumotlarni olib, ET₀/ETc ni hisoblaydi va RAW bilan solishtiradi.</li>
        </ul>
      </details>

      <div class="twoCol">
        <div>
          <h3>Natija (API)</h3>
          <div id="api_summary" class="summary muted">Hisoblash uchun ma’lumotlarni kiriting.</div>
        </div>

        <div>
          <h3>Soatlik (birinchi 24 soat)</h3>
          <div class="tablewrap">
            <table id="api_hourlyTable">
              <thead>
                <tr>
                  <th>Vaqt</th>
                  <th>Soil %</th>
                  <th>ET0 (mm/soat)</th>
                  <th>ETc (mm/soat)</th>
                  <th>ET0 (m³/ga·soat)</th>
                  <th>ETc (m³/ga·soat)</th>
                  <th>Yomg‘ir (mm)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <h3>Kundalik (API’dan)</h3>
          <div class="tablewrap">
            <table id="api_dailyTable">
              <thead>
                <tr>
                  <th>Sana</th>
                  <th>Yog‘in (mm/kun)</th>
                  <th>Tmax (°C)</th>
                  <th>Tmin (°C)</th>
                  <th>Shortwave sum</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- MANUAL TAB -->
    <section id="tab-manual" class="card tabPanel">
      <h2>Manual rejim (FAO-56 Penman–Monteith)</h2>

      <div class="row between">
        <div class="seg">
          <button id="modeSnapshot" class="segBtn active">Bitta vaqt (snapshot)</button>
          <button id="modeSeries" class="segBtn">Soatlik qator (series)</button>
        </div>

        <div class="hint">
          Snapshot: bitta vaqt nuqtasi. Series: soatlik qiymatlar jadvali yoki CSV.
        </div>
      </div>

      <div class="grid">
        <label>
          Latitude
          <input id="m_lat" type="number" step="0.000001" value="0" />
        </label>

        <label>
          Longitude
          <input id="m_lon" type="number" step="0.000001" value="0" />
        </label>

        <label>
          Altitude (m)
          <input id="m_alt" type="number" step="1" value="0" />
        </label>

        <label>
          Sana (YYYY-MM-DD)
          <input id="m_date" type="date" />
        </label>

        <label>
          Vaqt (HH:MM)
          <input id="m_time" type="time" />
        </label>

        <label>
          Kc
          <input id="m_kc" type="number" step="0.01" value="0" />
        </label>

        <label>
          RAW (%)
          <input id="m_raw" type="number" step="0.1" value="0" />
        </label>

        <label>
          Tuproq namligi (%) (manual)
          <input id="m_soil" type="number" step="0.1" value="0" />
        </label>
      </div>

      <!-- Snapshot inputs -->
      <div id="snapshotBox" class="card inner">
        <h3>Bitta vaqt (snapshot) kiritish</h3>
        <div class="grid">
          <label>Harorat T (°C) <input id="s_T" type="number" step="0.1" value="0" /></label>
          <label>Nisbiy namlik RH (%) <input id="s_RH" type="number" step="0.1" value="0" /></label>
          <label>Shamol u10 (m/s) <input id="s_u10" type="number" step="0.1" value="0" /></label>
          <label>Bosim P (hPa) <input id="s_P" type="number" step="0.1" value="0" /></label>
          <label>Qisqa to‘lqinli radiatsiya Rs (W/m²) <input id="s_Rs" type="number" step="1" value="0" /></label>
          <label>Bulut cover (%) <input id="s_cloud" type="number" step="1" value="0" /></label>
        </div>
        <div class="row">
          <button id="runManualSnapshot" class="btn">Manual snapshot hisoblash</button>
        </div>
        <p class="micro">
          Izoh: Rs (W/m²) soatlik o‘rtacha sifatida qabul qilinadi. Longwave radiatsiya FAO-56 uslubida baholanadi.
        </p>
      </div>

      <!-- Series inputs -->
      <div id="seriesBox" class="card inner hidden">
        <h3>Soatlik qator (series) kiritish</h3>

        <div class="row between">
          <div class="micro">
            Jadvalga soatlik qiymatlarni kiriting yoki CSV paste qiling.
            Minimal ustunlar: <b>time,T,RH,u10,P,Rs,cloud</b>.
            Ixtiyoriy: <b>soil</b> (tuproq namligi %, agar har soat kiritmoqchi bo‘lsangiz).
          </div>
          <button id="add24" class="btn ghost">24 soat yaratish</button>
        </div>

        <div class="row">
          <textarea id="csvPaste" class="textarea" placeholder="CSV paste (ixtiyoriy)
time,T,RH,u10,P,Rs,cloud,soil
2025-12-13T00:00,0,0,0,0,0,0,0
..."></textarea>
        </div>

        <div class="row">
          <button id="loadCsv" class="btn ghost">CSV dan yuklash</button>
          <button id="runManualSeries" class="btn">Manual series hisoblash</button>
        </div>

        <div class="tablewrap">
          <table id="seriesTable">
            <thead>
              <tr>
                <th>time</th>
                <th>T (°C)</th>
                <th>RH (%)</th>
                <th>u10 (m/s)</th>
                <th>P (hPa)</th>
                <th>Rs (W/m²)</th>
                <th>cloud (%)</th>
                <th>soil % (ixtiyoriy)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="twoCol">
        <div>
          <h3>Natija (Manual)</h3>
          <div id="m_summary" class="summary muted">Manual hisoblashni bajaring.</div>
        </div>

        <div>
          <h3>Manual soatlik (birinchi 24 soat)</h3>
          <div class="tablewrap">
            <table id="m_hourlyTable">
              <thead>
                <tr>
                  <th>Vaqt</th>
                  <th>Soil %</th>
                  <th>ET0 (mm/soat)</th>
                  <th>ETc (mm/soat)</th>
                  <th>ET0 (m³/ga·soat)</th>
                  <th>ETc (m³/ga·soat)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <p class="micro">
            Manual rejimda yomg‘ir avtomatik hisoblanmaydi. Tuproq namligi snapshot qiymati yoki series jadvalidagi “soil” (agar kiritilgan bo‘lsa) ishlatiladi.
          </p>
        </div>
      </div>
    </section>

    <!-- REPORT TAB -->
    <section id="tab-report" class="card tabPanel">
      <h2>Hisobot (API vs Manual)</h2>
      <p class="micro">
        PDF hisobot shu bo‘limdagi ma’lumotlardan shakllantiriladi.
        Avval API va Manual hisoblashlarini bajaring.
      </p>

      <div class="row">
        <button id="buildReport" class="btn ghost">Hisobotni yangilash</button>
      </div>

      <div id="reportPreview" class="summary muted">
        Hisobotni ko‘rish uchun “Hisobotni yangilash” tugmasini bosing.
      </div>
    </section>

    <!-- Hidden PDF area -->
    <section id="reportPdf" class="reportPage hidden">
      <div class="reportHeader">
        <div>
          <div class="reportTitle">Sug‘orish Hisoboti</div>
          <div class="reportSub">API (Open-Meteo) va Manual (FAO-56 Penman–Monteith) taqqoslash</div>
        </div>
        <div class="reportMeta" id="reportMeta"></div>
      </div>

      <div class="reportGrid">
        <div class="reportCard">
          <h3>API natijalari</h3>
          <div id="reportApiBlock" class="reportBlock"></div>
        </div>

        <div class="reportCard">
          <h3>Manual natijalari</h3>
          <div id="reportManualBlock" class="reportBlock"></div>
        </div>
      </div>

      <div class="reportCard">
        <h3>Taqqoslash</h3>
        <div id="reportCompareBlock" class="reportBlock"></div>
      </div>

      <div class="reportCard">
        <h3>Soatlik ko‘rsatkichlar (qisqa jadval)</h3>
        <div class="reportTables">
          <div>
            <h4>API (birinchi 12 soat)</h4>
            <table id="reportApiTable" class="reportTable">
              <thead><tr><th>Vaqt</th><th>Soil%</th><th>ET0</th><th>ETc</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div>
            <h4>Manual (birinchi 12 soat)</h4>
            <table id="reportManualTable" class="reportTable">
              <thead><tr><th>Vaqt</th><th>Soil%</th><th>ET0</th><th>ETc</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="reportFooter">
        <div>Hisobot brauzerda yaratildi. API tuproq namligi model asosida (manual kiritilmasa).</div>
      </div>
    </section>

  </main>

  <script defer src="app.js"></script>
</body>
</html>
